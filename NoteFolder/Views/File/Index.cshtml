@model FileVM

<div id="fileInfo">
	@Html.ActionLink("Guest's files", "Index", new { path = "" }, new { @class = "pathWord pathLink" })
	@{ var pathSections = Model.Path.Split(new char[] { '/' }, StringSplitOptions.RemoveEmptyEntries); }
	@for(int i = 1;i<pathSections.Length;++i) {
		string[] partialPath = new string[i];
		Array.Copy(pathSections, partialPath, i);
		string path = string.Join("/", partialPath);

		<span class="pathSeparator"> / </span>@Html.ActionLink(partialPath[i - 1], "Index", new { path = path }, new { @class = "pathWord pathLink" })
	}
	@if(!Model.IsRootFolder) {
		<span class="pathSeparator"> / </span><span class="pathWord pathName">@Model.Name</span>
		<div class="desc">@Model.Description</div>
		<div class="times">
			<div class="time">Created: @Model.TimeCreated</div>
			@if(Model.TimeCreated != Model.TimeLastEdited) {
				<div class="time">Last edited: @Model.TimeLastEdited</div>
			}
		</div>
	}
	@TempData["LastAction"]
	@if(!Model.IsRootFolder) {
		<input type="button" id="editBtn" class="mainBtn" value="Edit @Model.Name" />
		@Html.Partial("_Edit", Model)
	}
	@if(Model.IsFolder) {
		<input type="button" id="newFolderBtn" class="mainBtn" value="New Folder" />
		<input type="button" id="newNoteBtn" class="mainBtn" value="New Note" />
		@Html.Partial("_Create", new FileVM { IsFolder = true, ParentID = Model.ExistingID, Path = Model.Path })
		@Html.Partial("_Create", new FileVM { IsFolder = false, ParentID = Model.ExistingID, Path = Model.Path })
	}
	<div id="allContents">
		Contents:
		@Html.Partial("_Contents", Model)
	</div>
</div>

@section PageScripts{
<script type="text/javascript"> @* todo: Find a good organization scheme for scripts. *@
	function checkAjaxSuccess(result, id) {
		if (result.success) {
			window.location.href = '/guest/files/' + result.path; @* todo: username will go here *@
		}
		else {
			$('#' + id).replaceWith(result.html);
		}
	}
	$('#editBtn').click(function () {
		$('#editForm').toggle()
	});
	$('#newFolderBtn').click(function () {
		$('#createFolderForm').toggle();
		$('#createNoteForm').toggle(false);
	});
	$('#newNoteBtn').click(function () {
		$('#createNoteForm').toggle();
		$('#createFolderForm').toggle(false);
	});
</script>
}
